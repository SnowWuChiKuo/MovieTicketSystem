@model ClientSide.Models.ViewModels.ProfileVm

@{
    ViewBag.Title = "個人資料編輯";
}

<h2 class="fw-bolder">個人資料編輯</h2>


@using (Html.BeginForm("EditProfile", "Members", FormMethod.Post, new { id = "editForm" }))
{
    @Html.AntiForgeryToken()

    @*<link rel="stylesheet" href="~/Content/bootstrap.min.css" />*@
    <div class="form-horizontal">
        <!--h4>ProfileVm</h4-->
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="mb-3">
            @Html.LabelFor(model => model.Account, htmlAttributes: new { @class = "form-label col-md-2" })
            @Model.Account

            <!--div class="col-md-10"-->
            @*@Html.EditorFor(model => model.Account, new { htmlAttributes = new { @class = "form-control form-control-sm" } })*@
            @*@Html.ValidationMessageFor(model => model.Account, "", new { @class = "text-danger" })*@
            <!--/div-->
        </div>

        <div class="mb-3">
            @Html.LabelFor(model => model.Email, htmlAttributes: new { @class = "form-label col-md-2" })
            <!--div class="col-md-10"-->
            @Html.EditorFor(model => model.Email, new { htmlAttributes = new { @class = "form-control form-control-sm" } })
            @Html.ValidationMessageFor(model => model.Email, "", new { @class = "text-danger" })
            <!--/div-->
        </div>

        <div class="mb-3">
            @Html.LabelFor(model => model.Name, htmlAttributes: new { @class = "form-label col-md-2" })
            <!--div class="col-md-10"-->
            @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control form-control-sm" } })
            @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
            <!--/div-->
        </div>

        <div class="mb-3">
            <!--div class="col-md-offset-2 col-md-10"-->
            <input type="submit" value="儲存" class="btn btn-primary btn-sm" />
            @Html.ActionLink("回會員中心", "Index", null, new { @class = "btn btn-sm btn-secondary" })
            <!--/div-->
        </div>

    </div>
}
@using (Html.BeginForm("DeleteMember", "Members", FormMethod.Post, new { id = "deleteForm" }))
{
    @Html.AntiForgeryToken()
    <div class="mb-3 mt-5 container">
        <div class="row align-items-center">
            <div class="col-auto">
                <label class="fw-bolder">
                    確認是否要取消會員身分?
                    @Html.CheckBoxFor(model => model.IsDeleted, new { @class = "align-middle" })
                </label>
            </div>
            <div class="col-auto">
                <input type="submit" value="取消會員" class="btn btn-danger btn-sm" />
            </div>
        </div>
    </div>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @if (TempData.Peek("ShowSuccessAlert") != null && (bool)TempData.Peek("ShowSuccessAlert") == true)
    {
        <script>
            $(function () {
                Swal.fire({
                    title: '個人資料編輯成功',
                    text: '您的個人資料已成功更新。',
                    icon: 'success',
                    confirmButtonText: '確認'
                }).then((result) => {
                     if (result.isConfirmed) {
                        window.location.href = '@Url.Action("EditProfile", "Members")';
                    }
                 })
            });
        </script>
        TempData.Remove("ShowSuccessAlert");
    }
    @if (TempData.Peek("SweetAlertTitle") != null)
    {
        <script>
            $(function () {
                Swal.fire({
                    title: '@TempData.Peek("SweetAlertTitle")',
                    text: '@TempData.Peek("SweetAlertText")',
                    icon: '@TempData.Peek("SweetAlertIcon")',
                    confirmButtonText: '確認'
                }).then((result) => {
                    if (result.isConfirmed) {
                       @if(TempData.Peek("SweetAlertTitle").ToString() == "會員資料已取消")
                       {
                         @:window.location.href = '@Url.Action("Logout", "Members")';
                       }
                       else
                       {
                          @:window.location.href = '@Url.Action("EditProfile", "Members")';
                       }
                    }
                 })
            });
        </script>
        TempData.Remove("SweetAlertTitle");
        TempData.Remove("SweetAlertText");
        TempData.Remove("SweetAlertIcon");
    }
    <script>
        $(function () {
            $('#deleteForm').submit(function (e) {
                var isDeletedChecked = $('#IsDeleted').is(':checked');
                if (isDeletedChecked) {
                    e.preventDefault(); // Prevent default form submission
                    Swal.fire({
                        title: '確認取消會員身分',
                        text: '您確定要取消您的會員身分嗎？',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: '是的，取消會員',
                        cancelButtonText: '取消'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            this.submit(); // Manually submit form if confirmed
                        }
                    });
                }
            });
        });
    </script>
}
